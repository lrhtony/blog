<% if (site.categories.length) { %>
  <div class="kira-widget-wrap">
    <h3 class="kira-widget-title">分类</h3>
    <div class="kira-widget">
      <ul class="category-list">
        <%
        /**
         * 使用 Map 进行分类去重
         * 合并相同名称的分类，累加文章数量
         */
        const uniqueCategories = new Map();
        
        site.categories.sort('name').each(function(item) {
          if (uniqueCategories.has(item.name)) {
            // 分类已存在，累加数量
            const existing = uniqueCategories.get(item.name);
            existing.length += item.length;
          } else {
            // 新分类，添加到 Map
            uniqueCategories.set(item.name, {
              name: item.name,
              path: item.path,
              length: item.length
            });
          }
        });
        
        // 转换为数组以便遍历
        const finalCategories = Array.from(uniqueCategories.values());
        %>

        <% finalCategories.forEach(function(category) { %>
          <li class="category-list-item">
            <a class="category-list-link" href="<%- config.root %><%- category.path %>">
              <%= category.name %>
            </a>
            <span class="category-list-count"><%= category.length %></span>
          </li>
        <% }); %>
      </ul>
    </div>
  </div>
<% } %>